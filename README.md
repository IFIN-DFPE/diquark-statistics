# Diquark analysis

This repository contains the tools needed to perform statistical analysis of the runs on the ultraheavy scalar diquark  $S_{uu}$ and plot the **_local p-value_**, the $CL_{S}$ scan vs. the mass $M_{S_{uu}}$ and the $95\%$ Upper Limits on the signal strength parameter $\mu^{95}$. 

The main framework that has been used is [ROOT](https://root.cern) along with its libraries [RooFit](https://root.cern/manual/roofit/) and [RooStats](https://root.cern/doc/v630/group__Roostats.html) that contain the necessary tools for creating distribution functions, generating toy data, fitting and hypothesis testing. 


## Exclusion Run
The exclusion run is performed within [roofit_stats.cc](roofit_stats.cc) which takes the signal yields from the ML algorithm used prior to differentiate signal from background after the simulations were run (not the object of this work). The program loads its work mode from [stats.ini](stats.ini) and it performs the statistical analysis as such:
 - Generates the _Likelihood function_ for given signal and background yields, with lognormal constraints on each.
 - Generates background-only _pseudo-experiments_ and fits the nuisance parameters under both s+b and b-only hypotheses. After that, it computes the test statistic $q_{\mu}^{obs}$ as defined [here](https://indico.cern.ch/event/126652/contributions/1343592/attachments/80222/115004/Frequentist_Limit_Recommendation.pdf).
 - Generates _toy datasets_ for each pseudo-experiment and computes $q_{\mu}^{toy}$ which is compared to $q_{\mu}^{obs}$ and accumulated for later computations.
 - Computes $CL_S$ as described and compares is to the confidence level set by the user to check if the pseudo-experiment can be excluded.
 - Computes the local p-value as $P(q_{\mu}^{toy}>q_{\mu}^{obs}|M_{S_{uu}})$
 - The results are saved in .root format in the [results](results) folder.
### Running the code
The exclusion run code can be executed by calling the [run_roofit.sh](run_roofit.sh) as:
```
./run_roofit.sh
```
 In order to change working parameters please edit the configuration file [stats.ini](stats.ini). You can give values for the following parameters:
 - _discriminator_: the value of the discriminator used in ML.
 - _runType_: can take two values depending on the working mode desired
    - _point_: runs analysis on a single mass point
    - _full_: runs the analysis over all masses (though not entirely advised to use this option)
 - _mass_: $M_{S_{uu}}$ expressed in TeV. Only used if **_runType = point_**
 - _nPseudoExps_: the number of pseudo-experiments to be run.
 - _nToys_: the number of toys generated for each pseudo-experiment.

When running the program, please keep in mind to change the path of the log file in the bash script, otherwise overwriting may happen. For further details, please refer to the code.


## Upper Limits Run
The computation of $\mu^{95}$ is done in [roostats_limits_run.cc](roostats_limits_run.cc), which takes as input one of the files containing the signal and background yields and does the following:
 - Generates the _Likelihood function_ for given signal and background yields, with lognormal constraints on each.
 - Uses _RooStats::AsymptoticCalculator_ for the limit computation, which is implemented using methods presented [here](https://arxiv.org/abs/1007.1727). The hypotheses are then inverted and the values for $\mu^{95}$ are found.
 - The plots, the Upper Limits, and the expected median, $\pm1\sigma$ and $\pm2\sigma$ are saved in the [results](results) folder.
### Running the code
The Upper Limits run can be executed by calling [run_roostats.sh](run_roostats.sh) as:
```
./run_roostats.sh
```
When running this macro, please keep in mind to change the path of the log file in the bash script, otherwise overwriting might happen. For further details, please refer to the code.


## Plots
- _Local p-value plot is still under implementation_.
- The $CL_{S}$ scan vs. $M_{S_{uu}}$ plot is generated using [plot_cls.cc](plot_cls.cc).
- _Upper limit plot is still under implementation_
### Running the code
The plots can be generated by calling [create_plots.sh](create_plots.sh) as:
```
./create_plots.sh
```